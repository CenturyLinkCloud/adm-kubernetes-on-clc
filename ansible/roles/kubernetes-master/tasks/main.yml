- name: Add kube-apiserver service configuration.
  template: src=kube-apiserver.conf.j2 dest=/etc/init/kube-apiserver.conf

- name: Create a placeholder token file
  shell: touch /srv/kubernetes/known_tokens.csv

- set_fact:
    kube_admin_password:  "{{ lookup('password', '{{ kube_config_local }}/admin_password.txt') }}"

- name: Add kube-apiserver password
  template: src=basic-auth.j2 dest=/srv/kubernetes/password

- name: Enable kube-apiserver service.
  service: name=kube-apiserver enabled=yes

- name: Start kube-apiserver service.
  service: name=kube-apiserver state=restarted

- name: Add kube-controller-manager service configuration.
  template: src=kube-controller-manager.conf.j2 dest=/etc/init/kube-controller-manager.conf

- name: Enable kube-controller-manager service.
  service: name=kube-controller-manager enabled=yes

- name: Start kube-controller-manager service.
  service: name=kube-controller-manager state=restarted

- name: Add kube-scheduler service configuration.
  template: src=kube-scheduler.conf.j2 dest=/etc/init/kube-scheduler.conf

- name: Enable kube-scheduler service.
  service: name=kube-scheduler enabled=yes

- name: Start kube-scheduler service.
  service: name=kube-scheduler state=restarted

- name: Install httplib2.
  apt: name=python-httplib2 state=present
